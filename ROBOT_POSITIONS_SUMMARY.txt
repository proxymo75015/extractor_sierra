================================================================================
           ROBOT POSITION EXTRACTION - R√âSUM√â EX√âCUTIF
================================================================================

OBJECTIF
--------
Extraire les coordonn√©es X/Y exactes o√π ScummVM positionne les vid√©os Robot
de Phantasmagoria pour reproduire le positionnement lors de l'extraction.

D√âCOUVERTE CL√â
--------------
Les coordonn√©es Robot ne sont PAS stock√©es dans les fichiers .RBT !
Elles sont pass√©es dynamiquement via l'appel kernel kRobotOpen() :

    kRobotOpen(robotId, plane, priority, X, Y, scale)
                                         ‚Üë  ‚Üë
                                      argv[3] argv[4]

Code source: engines/sci/engine/kvideo.cpp:266-276

SOLUTION RECOMMAND√âE
--------------------
Patcher ScummVM pour logger les coordonn√©es lors de l'appel kRobotOpen :

    1. Patcher ScummVM (scummvm_robot_patch.diff)
    2. Compiler avec debug activ√©
    3. Lancer Phantasmagoria et jouer quelques minutes
    4. Parser les logs (parse_robot_logs.py)
    5. Obtenir robot_positions.txt

FICHIERS CR√â√âS
--------------
Documentation:
  ‚úì README_ROBOT_POSITIONS.md              (guide rapide)
  ‚úì ROBOT_POSITION_EXTRACTION_GUIDE.md     (guide complet 4 m√©thodes)
  ‚úì ROBOT_POSITION_INVESTIGATION_SUMMARY.md (rapport technique)
  ‚úì FILE_INDEX.md                          (index de tous les fichiers)

Scripts:
  ‚úì scummvm_robot_patch.diff               (patch pour ScummVM)
  ‚úì extract_robot_positions.sh             (script automatique)
  ‚úì parse_robot_logs.py                    (parser de logs)

Code Exemple:
  ‚úì robot_position_loader_example.cpp      (int√©gration C++)

Tests:
  ‚úì test_scummvm_log.txt                   (log exemple)
  ‚úì test_robot_positions.txt               (sortie exemple)

COMMANDES RAPIDES
-----------------
# M√©thode automatique (recommand√©e):
./extract_robot_positions.sh

# M√©thode manuelle:
cd ~/scummvm
patch -p1 < scummvm_robot_patch.diff
./configure --enable-debug --disable-all-engines --enable-engine=sci
make -j$(nproc)
./scummvm --debugflags=all --debuglevel=1 phantasmagoria_game 2>&1 | tee logs.txt
python3 parse_robot_logs.py logs.txt robot_positions.txt

FORMAT robot_positions.txt
--------------------------
# Format: robot_id X Y
1000 150 143
230 180 160
91 175 150

SP√âCIFICATIONS TECHNIQUES
--------------------------
R√©solution du jeu : 630√ó450 pixels
Origine           : Coin sup√©rieur gauche (0,0)
Format RBT        : Version 5/6 (header = 22)
Moteur SCI        : SCI2.1 Early
Kernel ID kRobot  : 0x7B (123 decimal)

HEADERS RBT D√âCOD√âS
-------------------
Offset 0x00: version = 22
Offset 0x08: audioBlockSize = 2221
Offset 0x0E: numFramesTotal (143, 207, etc.) ‚Üê NOT Y coordinate!
Offset 0x14: xResolution = 0 ‚Üê "use game coordinates"
Offset 0x16: yResolution = 0 ‚Üê "use game coordinates"

POURQUOI PAS DANS LES SCRIPTS ?
--------------------------------
Les coordonn√©es sont stock√©es comme propri√©t√©s d'objets (HEAP), pas comme
constantes hardcod√©es. Le parser SCI (src/sci_robot_positions.cpp) a confirm√©
qu'aucun appel direct avec coordonn√©es constantes n'existe.

PROCHAINES √âTAPES
-----------------
1. Ex√©cuter extract_robot_positions.sh OU extraire manuellement
2. Obtenir robot_positions.txt avec coordonn√©es r√©elles
3. Int√©grer dans src/main.cpp (voir robot_position_loader_example.cpp)
4. Tester extraction avec positionnement exact
5. Comparer visuellement avec ScummVM

VALIDATION
----------
‚úì Parser SCI cr√©√© et test√© ‚Üí 0 coordonn√©es hardcod√©es (attendu)
‚úì Headers RBT analys√©s ‚Üí xRes=0, yRes=0 confirme "use game coords"
‚úì Code ScummVM identifi√© ‚Üí kRobotOpen argv[3]=X argv[4]=Y
‚úì Parser de logs cr√©√© et test√© ‚Üí extraction correcte
‚úì Documentation compl√®te r√©dig√©e

RESSOURCES
----------
Guide rapide   : README_ROBOT_POSITIONS.md
Guide complet  : ROBOT_POSITION_EXTRACTION_GUIDE.md
Rapport tech   : ROBOT_POSITION_INVESTIGATION_SUMMARY.md
Index fichiers : FILE_INDEX.md
Code exemple   : robot_position_loader_example.cpp

SUPPORT
-------
ScummVM Source: https://github.com/scummvm/scummvm
SCI Wiki      : https://wiki.scummvm.org/index.php/SCI
kRobotOpen    : engines/sci/engine/kvideo.cpp:266

================================================================================
                      Bonne extraction ! üé¨
================================================================================
